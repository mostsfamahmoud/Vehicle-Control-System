/*
 ============================================================================
 Name        : Vehicle.c
 Author      : Mostafa Mahmoud Ali
 Version     :
 Copyright   : Your copyright notice
 Description : Source file for Vehicle Control System
 ============================================================================
 */

#include "Vehicle.h"


void vehicle_Init(Vehicle *ptrVec){
	ptrVec->AC = OFF;
	ptrVec->engine = ON;
	ptrVec->engineTempController = OFF;
	ptrVec->speed = 50;
	ptrVec->engineTemp = 90;
	ptrVec->roomTemp = 35;
}

void startVehicleMenu(Vehicle *ptrVec) {

	uint8_t input;
	printf("a. Turn on the vehicle engine\n");
	printf("b. Turn off the vehicle engine\n");
	printf("c. Quit the system\n\n");

	fflush(stdout);
	scanf(" %c", &input);

	switch (input) {
	case 'a':
	case 'A':
		vehicleEngine_ON(ptrVec);
		break;
	case 'b':
	case 'B':
		vehicleEngine_OFF(ptrVec);
		break;
	case 'c':
	case 'C':
		quitSystem();
		break;
	default:
		break;
	}
}

void vehicleEngine_ON(Vehicle *ptrVec) {

	ptrVec->engine = ON;
	uint8_t choice;

	while (ptrVec->engine == ON) {

		printf("\n");
		printf("a. Turn off the engine \n");
		printf("b. Set the traffic light color \n");
		printf("c. Set the room temperature (Temperature Sensor) \n");
		printf("d. Set the engine temperature (Engine Temperature Sensor) \n\n");

		fflush(stdout);
		scanf(" %c", &choice);

		if ((choice == 'a') || (choice == 'A')) {
			ptrVec->engine = OFF;
			vehicleEngine_OFF(ptrVec);
			return;
		}
		else
			setVehicleProperties(choice, ptrVec);

		specialVehicleSpeed(ptrVec);

		displayVehicleInformation(ptrVec);
	}

}

void vehicleEngine_OFF(Vehicle *ptrVec) {

	printf("\nTurn OFF Vehicle Engine\n\n");
	startVehicleMenu(ptrVec);
}

void quitSystem(void) {
	printf("\nQuit The System\n");
	return;
}

void setVehicleProperties(uint8_t choice, Vehicle *ptrVec) {

	uint8_t color;

	if ((choice == 'b') || (choice == 'B')) {
		printf("Enter the required traffic light color:\n"
				"Red: Enter r \tOrange: Enter o \tGreen: Enter g\n\n");
		fflush(stdout);
		scanf(" %c", &color);
		setSpeed(color, &ptrVec->speed);

	} else if ((choice == 'c') || (choice == 'C')) {
		printf("\nEnter the required room temperature:\n");
		fflush(stdout);
		scanf("%hhd", &ptrVec->roomTemp);
		setRoomTemperature_AC(&ptrVec->roomTemp, &ptrVec->AC);

	} else if ((choice == 'd') || (choice == 'D')) {
		printf("\nEnter the required engine temperature:\n");
		fflush(stdout);
		scanf("%hd", &ptrVec->engineTemp);
		setEngine_Temperature_Controller(&ptrVec->engineTemp, &ptrVec->engineTempController);

	}
}

void setSpeed(uint8_t trafficLight, uint8_t *speed) {

	switch (trafficLight) {
	case 'g':
	case 'G':
		*speed = 100;
		break;
	case 'o':
	case 'O':
		*speed = 30;
		break;
	case 'r':
	case 'R':
		*speed = 0;
		break;
	default:
		break;
	}
}

void setRoomTemperature_AC(uint8_t *roomTemperture, State *acValue) {

	if ((*roomTemperture < 10) || (*roomTemperture > 30)) {
		*roomTemperture = 20;
		*acValue = ON;
	} else
		*acValue = OFF;
}

void setEngine_Temperature_Controller(uint16_t *engineTemperature, State *tempController) {

	if ((*engineTemperature < 100) || (*engineTemperature > 150)) {
		*engineTemperature = 125;
		*tempController = ON;
	}
	else
		*tempController = OFF;
}

void displayVehicleInformation(Vehicle *ptrVec){

	printf("\n");
	printf((ptrVec->engine == ON) ? "Engine state: ON\n" : "Engine state: OFF\n");
	printf((ptrVec->AC == ON) ? "AC state: ON\n" : "AC state: OFF\n");
	printf("Vehicle Speed: %d Km/Hr\n", ptrVec->speed);
	printf("Room Temperature: %d C\n", ptrVec->roomTemp);
	printf((ptrVec->engineTempController == ON) ?"Engine Temperature Controller State: ON\n" :
					"Engine Temperature Controller State: OFF\n");
	printf("Engine Temperature: %d C\n", ptrVec->engineTemp);
}

void specialVehicleSpeed(Vehicle *ptrVec) {

	if (ptrVec->speed == 30) {

		if (ptrVec->AC == OFF)
			ptrVec->AC = ON;

		if (ptrVec->engineTempController == OFF)
			ptrVec->engineTempController = ON;

		ptrVec->roomTemp = ptrVec->roomTemp * (5.0 / 4) + 1;

		ptrVec->engineTemp = ptrVec->engineTemp * (5.0 / 4) + 1;
	}
	else
		return;
}






